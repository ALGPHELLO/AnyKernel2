# Flash Kernel initialization script
# Pieces taken from @anarkia1976, @franciscofranco, @frap129, and @flar2

# Import Spectrum profiles
import /init.profiles.rc

on boot
    # Wake gestures
    chown root root /sys/android_touch/wake_gestures
    chmod 666 /sys/android_touch/wake_gestures
    write /sys/android_touch/wake_gestures 0
    chmod 644 /sys/android_touch/wake_gestures

    # Disable double tap to wake
    chown root root /sys/android_touch/doubletap2wake
    chmod 666 /sys/android_touch/doubletap2wake
    write /sys/android_touch/doubletap2wake 0
    chmod 644 /sys/android_touch/doubletap2wake

    # Disable sweep to sleep
    chown root root /sys/android_touch/sweep2sleep
    chmod 666 /sys/android_touch/sweep2sleep
    write /sys/android_touch/sweep2sleep 0
    chmod 644 /sys/android_touch/sweep2sleep

    # Enable sweep to wake in up direction
    chown root root /sys/android_touch/sweep2wake
    chmod 666 /sys/android_touch/sweep2wake
    write /sys/android_touch/sweep2wake 4
    chmod 644 /sys/android_touch/sweep2wake

    # Disable camera gesture
    chown root root /sys/android_touch/camera_gesture
    chmod 666 /sys/android_touch/camera_gesture
    write /sys/android_touch/camera_gesture 0
    chmod 644 /sys/android_touch/camera_gesture

    # Set vibration strength to 27 (50% in EXKM)
    chown root root /sys/android_touch/vib_strength
    chmod 666 /sys/android_touch/vib_strength
    write /sys/android_touch/vib_strength 27
    chmod 644 /sys/android_touch/vib_strength

on property:sys.boot_completed=1
    # according to Qcom this legacy value improves first launch latencies
    # stock value is 512k
    # from franciscofranco
    setprop dalvik.vm.heapminfree 2m

    # Make sure governor sys paths have the correct permissions
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor
    chown system system /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor
    chmod 0664 /sys/devices/system/cpu/cpu4/cpufreq/scaling_governor

    # Make sure all the cpufreq sys paths have the correct permissions
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
    chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_min_freq
    chown system system /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
    chmod 0664 /sys/devices/system/cpu/cpu0/cpufreq/scaling_max_freq
    chown system system /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
    chmod 0664 /sys/devices/system/cpu/cpu4/cpufreq/scaling_min_freq
    chown system system /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq
    chmod 0664 /sys/devices/system/cpu/cpu4/cpufreq/scaling_max_freq

    # Disable core control, enable msm_thermal
    write /sys/module/msm_thermal/core_control/enabled 0
    write /sys/module/msm_thermal/parameters/enabled 1

    # Enable Fingerprint boost
    write /sys/kernel/fp_boost/enabled 1

    # Sound settings
    write /sys/kernel/sound_control/speaker_gain "23 23"
    write /sys/kernel/sound_control/headphone_pa_gain "1 1"
    write /sys/kernel/sound_control/mic_gain 10
    write /sys/kernel/sound_control/headphone_gain "6 6"

    # I/O scheduler - maple - 512kb
    write /sys/block/mmcblk0/queue/scheduler maple
    write /sys/block/mmcblk0/queue/read_ahead_kb 512

    # Don't treat storage as rotational
    write /sys/block/mmcblk0/queue/rotational 0

    # Vibration strength
    write /sys/class/timed_output/vibrator/vmax_mv_strong 2000
    write /sys/class/timed_output/vibrator/vmax_mv_light 1650

    # Special power script
    exec u:r:init:s0 root root -- /init.special_power.sh
